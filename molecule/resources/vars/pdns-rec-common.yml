---

##
# PowerDNS Recursor Configuration
##

pdns_rec_config:
  recursor:
    include_dir: "{{ pdns_rec_config_dir }}/recursor.d"
    threads: "2"
    max_mthreads: 1024
    extended_resolution_errors: "true"
    forward_zones:
      - zone: example-forward.com
        forwarders:
          - 127.0.0.1:5301
    rpzs:
      - name: /var/lib/pdns-recursor/rpz/test2.rpz
      - name: test.rpz
        addresses: "['127.0.0.2']"

  incoming:
    reuseport: yes
    allow_from: [ 127.0.0.0/8 ]

  webservice:
    address: "127.0.0.1"
    port: "8001"
    # Vaulted value for the webservice API key (plaintext: "powerdns")
    # Encrypted with molecule/resources/.vault-password
    api_key: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65663362656264366134623962616532323836663730613832393935396238643630313861326131
      3830613533646239623036616137303832663930356436340a643964383261343630373235613665
      64303534316563626534386164613062393436363863396264333134366339303434306134663764
      6665303539623030360a333133373365636532643435653130356233616136353430643165356332
      3265
    api_dir: "/var/lib/pdns-recursor/api"

pdns_rec_config_additional_dirs:
  - path: "{{ pdns_rec_config.webservice.api_dir }}"
    mode: '0775'
  - "{{ pdns_rec_config.recursor.include_dir }}"
  - "/var/lib/pdns-recursor/rpz"

pdns_rec_config_additional_files:
  - dest: "/var/lib/pdns-recursor/rpz/test2.rpz"
    content: |
      test2.rpz.               60   IN SOA    ns.test2.rpz. hostmaster.test2.rpz. 1 10800 60 3600 3600
      test-rpz.com.test2.rpz.  60   IN A  127.0.0.2

# Override service
pdns_rec_service_overrides:
  Unit:
    Description: PowerDNS Recursor (modified)
  Service:
    LimitCORE: infinity
    ExecStart: /usr/sbin/pdns_recursor --daemon=no --write-pid=no --disable-syslog --log-timestamp=no
    Environment:
      TEST_VAR1: TEST_VALUE1
      TEST_VAR2: TEST_VALUE2
